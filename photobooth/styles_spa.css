/* --- CORE VARIABLES --- */
:root {
    --bg-light: #FDFCF8;
    --text-dark: #2D3436;
    --text-dim: #636E72;
    --primary-accent: #000000;
    --secondary-accent: #6c5ce7;
    --danger: #FF6347;
    --glass: rgba(255, 255, 255, 0.25);
    --glass-border: rgba(255, 255, 255, 0.4);
    --card-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
}

/* --- BASE RESET --- */
* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    outline: none;
}

body {
    margin: 0;
    padding: 0;
    font-family: 'DM Sans', sans-serif;
    background: var(--bg-light);
    color: var(--text-dark);
    height: 100vh;
    width: 100vw;
    overflow: hidden;
}

/* --- VIEW MANAGER --- */
.view-section {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease, transform 0.4s ease;
    z-index: 0;
    background: var(--bg-light); 
}

.view-section.active {
    opacity: 1;
    pointer-events: auto;
    z-index: 10;
    transform: none !important;
}

/* Hide inactive views functionally */
.view-section:not(.active) {
    display: none; 
    /* To prevent interfering with layout calculations/rendering while hidden */
} 
/* But we need display block for transition... let's use a utility class for hard toggle 
   Actually, for simplicity, simple display toggle is safer for Fabric.js logic.
   If transitions are desired, we can use specific classes. 
   Let's stick to simple switching first to ensure logic works, 
   then add transitions if requested. 
*/
.view-section {
    display: none;
    opacity: 1;
}
.view-section.active {
    display: block; /* Flex/Grid overridden by specific view CSS */
}

/* --- AURORA BACKGROUND (Shared) --- */
.aurora-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background: #FDFCF8;
    overflow: hidden;
}

.aurora-blob {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.6;
    animation: float 25s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
}

.blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #B3E5FC; }
.blob-2 { bottom: -20%; right: -10%; width: 60vw; height: 60vw; background: #E0F7FA; animation-delay: -5s; }
.blob-3 { top: 40%; left: 40%; width: 40vw; height: 40vw; background: #E6E6FA; animation-delay: -10s; }

@keyframes float {
    from { transform: translate(0, 0) scale(1); }
    to { transform: translate(40px, 60px) scale(1.1); }
}

/* =========================================
   VIEW: LAYOUT SELECTION
   ========================================= */
#view-layout {
    overflow-y: auto;
    text-align: center;
    padding: 60px 20px;
}

#view-layout .layout-header {
    margin-bottom: 50px;
    animation: slideDown 1s ease;
}

#view-layout h1 {
    font-family: 'Playfair Display', serif;
    font-size: 3.5rem;
    margin: 0;
    letter-spacing: -1px;
}

#view-layout h1 span {
    font-style: italic;
    color: var(--secondary-accent);
}

.filter-bar {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 40px;
    flex-wrap: wrap;
}

.filter-btn {
    background: rgba(255,255,255,0.5);
    border: 1px solid rgba(0,0,0,0.1);
    padding: 8px 24px;
    border-radius: 50px;
    cursor: pointer;
    transition: 0.3s;
    font-size: 0.9rem;
    font-weight: 500;
}

.filter-btn.active, .filter-btn:hover {
    background: #fff;
    border-color: #000;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

.layout-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 30px;
    max-width: 1200px;
    margin: 0 auto;
}

.layout-card {
    background: rgba(255,255,255,0.6);
    border: 1px solid #fff;
    border-radius: 16px;
    padding: 15px;
    cursor: pointer;
    transition: 0.3s;
    backdrop-filter: blur(10px);
}

.layout-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.08);
    background: #fff;
}

.layout-card canvas {
    width: 100%;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

.card-info {
    margin-top: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 700;
    font-size: 0.9rem;
}

/* =========================================
   VIEW: BOOTH CAPTURE
   ========================================= */
#view-booth {
    background: #000; /* Camera bg */
}

/* Reset layout for booth view */
#view-booth-container {
    position: relative;
    width: 100%;
    height: 100%;
}

.booth-header {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    z-index: 50;
    background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent);
    color: #fff;
}

.main-stage {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
}

.camera-frame {
    width: 100%;
    height: 100%;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
}

video {
    width: 100%;
    height: 100%;
    object-fit: contain; /* Full visibility */
    transform: scaleX(-1);
}

/* Side Controls */
.side-controls {
    position: absolute;
    top: 75px; 
    right: 15px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 200;
    background: rgba(0, 0, 0, 0.2);
    padding: 8px 4px;
    border-radius: 30px;
    backdrop-filter: blur(4px);
}

.icon-btn {
    width: 38px;
    height: 38px;
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    cursor: pointer;
}

.icon-btn.active {
    background: #fff;
    color: #000;
}

/* Bottom Deck */
.control-deck {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    min-height: 70px;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.9) 10%, transparent);
    padding: 10px 15px 15px 15px;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 5px;
    align-items: end;
    z-index: 60;
}

#shutter-btn {
    width: 55px;
    height: 55px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    border: 3px solid rgba(255,255,255,0.7);
    position: relative;
    cursor: pointer;
}

#shutter-btn::after {
    content: '';
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 44px; height: 44px;
    background: #fff;
    border-radius: 50%;
    transition: 0.2s;
}

#shutter-btn:active::after {
    transform: translate(-50%, -50%) scale(0.9);
}

#shutter-btn.processing::after {
    background: transparent;
    border: 4px solid #fff;
    border-top-color: transparent;
    animation: spin 1s infinite linear;
}

/* Gallery Rail */
.gallery-rail {
    position: absolute;
    right: -120px;
    top: 150px;
    width: 100px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    transition: 0.3s;
    pointer-events: none; 
}
.gallery-rail.show {
    right: 20px;
    pointer-events: auto;
}

.rail-thumb {
    width: 100%;
    border-radius: 8px;
    border: 2px solid #fff;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

#countdown-display {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 8rem;
    font-weight: 800;
    color: #fff;
    text-shadow: 0 4px 20px rgba(0,0,0,0.5);
    display: none;
    z-index: 500;
}

#flash-overlay {
    position: fixed; inset: 0; background: #fff; z-index: 1000; pointer-events: none; opacity: 0;
}
.flash-active { animation: flash 0.3s ease-out; }

@keyframes flash { 0% { opacity: 1; } 100% { opacity: 0; } }
@keyframes spin { 100% { transform: translate(-50%, -50%) rotate(360deg); } }
@keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }


/* =========================================
   VIEW: CUSTOMIZE (STUDIO)
   ========================================= */
#view-customize {
    display: flex; /* Default hidden, but toggled via inline style or class in JS */
    flex-direction: column;
    background: #f8f8f8;
}

/* Desktop Studio Layout */
.studio-grid {
    display: grid;
    grid-template-columns: 70px 1fr 320px;
    grid-template-rows: 60px 1fr;
    height: 100%;
    width: 100%;
}

.studio-header {
    grid-column: 1 / -1;
    background: #fff;
    border-bottom: 1px solid rgba(0,0,0,0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 20px;
    z-index: 50;
}

.studio-sidebar {
    grid-column: 1;
    grid-row: 2;
    background: #fff;
    border-right: 1px solid rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px 0;
    gap: 10px;
}

.studio-stage {
    grid-column: 2;
    grid-row: 2;
    background: #f0f2f5;
    background-image: radial-gradient(#ccc 1px, transparent 1px);
    background-size: 20px 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    position: relative;
}

.studio-properties {
    grid-column: 3;
    grid-row: 2;
    background: #fff;
    border-left: 1px solid rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
}

/* Common Components */
.btn {
    border: none;
    background: transparent;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
}
.btn.primary { background: #000; color: #fff; }
.btn.icon { padding: 8px; justify-content: center; width: 36px; height: 36px; }

.tool-tab {
    width: 50px; height: 50px;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    cursor: pointer; color: #999; border-radius: 8px;
    border: none; background: transparent;
}
.tool-tab.active { background: #f0f0f0; color: #000; }
.tool-tab span { font-size: 0.6rem; margin-top: 4px; font-weight: 600; }

/* Mobile Overrides for Studio */
@media (max-width: 900px) {
    .studio-grid {
        display: flex;
        flex-direction: column;
    }
    .studio-sidebar, .studio-properties { display: none !important; }
    .studio-header { padding: 0 15px; }

    .mobile-nav {
        position: fixed; bottom: 0; left: 0; width: 100%; height: 70px;
        background: #fff; display: flex; justify-content: space-evenly;
        border-top: 1px solid rgba(0,0,0,0.05); z-index: 200;
    }
    
    .bottom-sheet {
        position: fixed; bottom: 0; left: 0; width: 100%; height: 55vh;
        background: #fff; z-index: 300; border-radius: 20px 20px 0 0;
        transform: translateY(110%);
        transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        display: flex; flex-direction: column;
        box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
    }
    .bottom-sheet.open { transform: translateY(0); }
    
    /* Center canvas on mobile */
    .studio-stage {
        padding-bottom: 80px; /* space for nav */
    }
}
